
import pandas as pd
import src as cf
import src as dd
import src as pp
import src as rc
import src as emb


class ServiceImpl:

    def data_prep_and_embed(self):
        df = pd.read_csv("data/articles.csv")

        model = emb.get_model(cf.SETTINGS.model_name)

        processed_df = pp.preprocess_articles(df)
        final_df = pp.get_value_from_description(processed_df)

        designer_df = dd.make_designer_df()

        prepped_corpora = rc.PreparedCorpora.build_corpora(
            final_df, designer_df
        )

        df_embeddings = emb.encode_texts(
            prepped_corpora.items_text, model
        )
        designer_embeddings = emb.encode_texts(
            prepped_corpora.designer_text, model
        )

        df_with_designers = rc.PreparedCorpora.attach_compatible_designers(
            final_df,
            df_embeddings,
            designer_embeddings,
            designer_df.index
        )

        return df_with_designers

    def generate_recommendation(self, query, df):
        user_recommendations_dict = rc.recommend_from_query(
            user_query=query,
            df_with_designers=df
        )

        return user_recommendations_dict["designers"]





